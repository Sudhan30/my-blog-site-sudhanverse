<svg viewBox="0 0 800 520" xmlns="http://www.w3.org/2000/svg" style="font-family: system-ui, -apple-system, sans-serif;">
  <defs>
    <linearGradient id="userGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6"/>
      <stop offset="100%" style="stop-color:#1d4ed8"/>
    </linearGradient>
    <linearGradient id="apiGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6"/>
      <stop offset="100%" style="stop-color:#6d28d9"/>
    </linearGradient>
    <linearGradient id="dbGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981"/>
      <stop offset="100%" style="stop-color:#059669"/>
    </linearGradient>
    <linearGradient id="llmGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b"/>
      <stop offset="100%" style="stop-color:#d97706"/>
    </linearGradient>
    <linearGradient id="searchGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#ec4899"/>
      <stop offset="100%" style="stop-color:#db2777"/>
    </linearGradient>
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#1a1a2e"/>
      <stop offset="100%" style="stop-color:#16213e"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.3"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="800" height="520" rx="16" fill="url(#bgGrad)"/>

  <!-- Background grid -->
  <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#ffffff" stroke-width="0.5" opacity="0.05"/>
  </pattern>
  <rect width="800" height="520" fill="url(#grid)"/>

  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" fill="#ffffff" font-size="18" font-weight="600">Chat System Data Flow</text>

  <!-- User/Browser Box -->
  <g filter="url(#shadow)">
    <rect x="30" y="70" width="140" height="80" rx="12" fill="url(#userGrad)"/>
    <text x="100" y="105" text-anchor="middle" fill="#ffffff" font-size="13" font-weight="600">User Browser</text>
    <text x="100" y="125" text-anchor="middle" fill="#e0e7ff" font-size="10">Message + Location</text>
    <text x="100" y="140" text-anchor="middle" fill="#e0e7ff" font-size="10">+ Images</text>
  </g>

  <!-- API Server Box -->
  <g filter="url(#shadow)">
    <rect x="250" y="60" width="160" height="100" rx="12" fill="url(#apiGrad)"/>
    <text x="330" y="95" text-anchor="middle" fill="#ffffff" font-size="13" font-weight="600">Hono API Server</text>
    <text x="330" y="115" text-anchor="middle" fill="#e0e0ff" font-size="10">Auth Middleware</text>
    <text x="330" y="130" text-anchor="middle" fill="#e0e0ff" font-size="10">SSE Streaming</text>
    <text x="330" y="145" text-anchor="middle" fill="#e0e0ff" font-size="10">Context Builder</text>
  </g>

  <!-- Arrow: User to API -->
  <defs><marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#60a5fa"/></marker></defs>
  <path d="M 170 110 L 240 110" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrowBlue)"/>

  <!-- Context Manager Box -->
  <g filter="url(#shadow)">
    <rect x="490" y="60" width="160" height="100" rx="12" fill="#374151"/>
    <text x="570" y="95" text-anchor="middle" fill="#ffffff" font-size="13" font-weight="600">Context Manager</text>
    <text x="570" y="115" text-anchor="middle" fill="#9ca3af" font-size="10">Recent Messages</text>
    <text x="570" y="130" text-anchor="middle" fill="#9ca3af" font-size="10">+ Summaries</text>
    <text x="570" y="145" text-anchor="middle" fill="#9ca3af" font-size="10">+ System Prompt</text>
  </g>

  <!-- Arrow: API to Context -->
  <defs><marker id="arrowPurple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#a78bfa"/></marker></defs>
  <path d="M 410 110 L 480 110" stroke="#a78bfa" stroke-width="2" fill="none" marker-end="url(#arrowPurple)"/>

  <!-- LLM Box -->
  <g filter="url(#shadow)">
    <rect x="680" y="70" width="100" height="80" rx="12" fill="url(#llmGrad)"/>
    <text x="730" y="105" text-anchor="middle" fill="#ffffff" font-size="13" font-weight="600">Ollama</text>
    <text x="730" y="125" text-anchor="middle" fill="#fef3c7" font-size="10">Gemma 3</text>
    <text x="730" y="140" text-anchor="middle" fill="#fef3c7" font-size="10">12B Model</text>
  </g>

  <!-- Arrow: Context to LLM -->
  <defs><marker id="arrowYellow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#fbbf24"/></marker></defs>
  <path d="M 650 110 L 670 110" stroke="#fbbf24" stroke-width="2" fill="none" marker-end="url(#arrowYellow)"/>

  <!-- Database Section -->
  <g filter="url(#shadow)">
    <rect x="180" y="220" width="200" height="140" rx="12" fill="url(#dbGrad)"/>
    <text x="280" y="250" text-anchor="middle" fill="#ffffff" font-size="13" font-weight="600">PostgreSQL</text>

    <!-- Table icons -->
    <rect x="200" y="265" width="70" height="35" rx="4" fill="#065f46"/>
    <text x="235" y="280" text-anchor="middle" fill="#a7f3d0" font-size="9" font-weight="500">messages</text>
    <text x="235" y="293" text-anchor="middle" fill="#6ee7b7" font-size="8">append-only</text>

    <rect x="285" y="265" width="75" height="35" rx="4" fill="#065f46"/>
    <text x="322" y="280" text-anchor="middle" fill="#a7f3d0" font-size="9" font-weight="500">summaries</text>
    <text x="322" y="293" text-anchor="middle" fill="#6ee7b7" font-size="8">versioned</text>

    <rect x="200" y="310" width="70" height="35" rx="4" fill="#065f46"/>
    <text x="235" y="325" text-anchor="middle" fill="#a7f3d0" font-size="9" font-weight="500">sessions</text>
    <text x="235" y="338" text-anchor="middle" fill="#6ee7b7" font-size="8">metadata</text>

    <rect x="285" y="310" width="75" height="35" rx="4" fill="#065f46"/>
    <text x="322" y="325" text-anchor="middle" fill="#a7f3d0" font-size="9" font-weight="500">users</text>
    <text x="322" y="338" text-anchor="middle" fill="#6ee7b7" font-size="8">auth</text>
  </g>

  <!-- Arrow: API to Database -->
  <defs><marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#34d399"/></marker></defs>
  <path d="M 330 160 L 330 180 L 280 180 L 280 210" stroke="#34d399" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>

  <!-- Web Search Box -->
  <g filter="url(#shadow)">
    <rect x="460" y="220" width="150" height="80" rx="12" fill="url(#searchGrad)"/>
    <text x="535" y="255" text-anchor="middle" fill="#ffffff" font-size="13" font-weight="600">Brave Search</text>
    <text x="535" y="275" text-anchor="middle" fill="#fce7f3" font-size="10">Location-aware</text>
    <text x="535" y="290" text-anchor="middle" fill="#fce7f3" font-size="10">Real-time data</text>
  </g>

  <!-- Arrow: API to Search -->
  <defs><marker id="arrowPink" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#f472b6"/></marker></defs>
  <path d="M 370 160 L 370 200 L 460 200 L 460 230 L 470 230" stroke="#f472b6" stroke-width="2" fill="none" marker-end="url(#arrowPink)"/>
  <text x="415" y="195" text-anchor="middle" fill="#f472b6" font-size="9">if needed</text>

  <!-- Background Job Box -->
  <g filter="url(#shadow)">
    <rect x="460" y="340" width="150" height="70" rx="12" fill="#1f2937"/>
    <text x="535" y="370" text-anchor="middle" fill="#ffffff" font-size="13" font-weight="600">Background Jobs</text>
    <text x="535" y="390" text-anchor="middle" fill="#9ca3af" font-size="10">Summarization</text>
    <text x="535" y="403" text-anchor="middle" fill="#9ca3af" font-size="10">async, non-blocking</text>
  </g>

  <!-- Arrow: Database to Background -->
  <defs><marker id="arrowGray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#6b7280"/></marker></defs>
  <path d="M 380 290 L 420 290 L 420 375 L 450 375" stroke="#6b7280" stroke-width="2" stroke-dasharray="5,5" fill="none" marker-end="url(#arrowGray)"/>

  <!-- Response flow back -->
  <path d="M 730 150 L 730 450 L 100 450 L 100 160" stroke="#60a5fa" stroke-width="2" stroke-dasharray="8,4" fill="none" marker-end="url(#arrowBlue)"/>
  <text x="400" y="470" text-anchor="middle" fill="#60a5fa" font-size="11" font-weight="500">SSE Stream Response</text>

  <!-- Legend -->
  <g transform="translate(30, 480)">
    <text x="0" y="0" fill="#9ca3af" font-size="10" font-weight="600">LEGEND:</text>
    <circle cx="70" cy="-4" r="6" fill="url(#userGrad)"/>
    <text x="82" y="0" fill="#9ca3af" font-size="9">Client</text>
    <circle cx="140" cy="-4" r="6" fill="url(#apiGrad)"/>
    <text x="152" y="0" fill="#9ca3af" font-size="9">Server</text>
    <circle cx="210" cy="-4" r="6" fill="url(#dbGrad)"/>
    <text x="222" y="0" fill="#9ca3af" font-size="9">Storage</text>
    <circle cx="285" cy="-4" r="6" fill="url(#llmGrad)"/>
    <text x="297" y="0" fill="#9ca3af" font-size="9">AI Model</text>
    <circle cx="370" cy="-4" r="6" fill="url(#searchGrad)"/>
    <text x="382" y="0" fill="#9ca3af" font-size="9">External API</text>
  </g>
</svg>
